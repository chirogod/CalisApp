<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:CalisApp.Models"
             xmlns:viewmodel="clr-namespace:CalisApp.ViewModels"
             x:DataType="viewmodel:SessionsViewModel"
             x:Class="CalisApp.Views.SessionsView"
             Title="Clases"
             BackgroundColor="#1a3029">

    <Grid RowDefinitions="Auto, *">

        <CollectionView Grid.Row="0"
                        ItemsSource="{Binding DiasCalendario}"
                        HeightRequest="90"
                        SelectionMode="None"
                        Margin="0,15,0,5">

            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Horizontal" ItemSpacing="10"/>
            </CollectionView.ItemsLayout>

            <CollectionView.Header>
                <BoxView WidthRequest="15" Color="Transparent"/>
            </CollectionView.Header>
            <CollectionView.Footer>
                <BoxView WidthRequest="15" Color="Transparent"/>
            </CollectionView.Footer>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="viewmodel:FechaFilter">
                    <Border StrokeShape="RoundRectangle 20"
                            StrokeThickness="0"
                            HeightRequest="70"
                            WidthRequest="60"
                            VerticalOptions="Center">

                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding Path=BindingContext.SelectDateCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                                  CommandParameter="{Binding .}"/>
                        </Border.GestureRecognizers>

                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="BackgroundColor" Value="#2d453d"/>
                                <Style.Triggers>
                                    <DataTrigger TargetType="Border" Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="BackgroundColor" Value="#facc43"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>

                        <VerticalStackLayout VerticalOptions="Center" Spacing="2">

                            <Label Text="{Binding DiaSemana}" 
                                   HorizontalOptions="Center" 
                                   FontSize="12"
                                   FontAttributes="Bold"
                                   TextTransform="Uppercase">
                                <Label.Style>
                                    <Style TargetType="Label">
                                        <Setter Property="TextColor" Value="#8ca096"/>
                                        <Style.Triggers>
                                            <DataTrigger TargetType="Label" Binding="{Binding IsSelected}" Value="True">
                                                <Setter Property="TextColor" Value="#1a3029"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Label.Style>
                            </Label>

                            <Label Text="{Binding DiaNumero}" 
                                   HorizontalOptions="Center" 
                                   FontSize="20" 
                                   FontAttributes="Bold">
                                <Label.Style>
                                    <Style TargetType="Label">
                                        <Setter Property="TextColor" Value="White"/>
                                        <Style.Triggers>
                                            <DataTrigger TargetType="Label" Binding="{Binding IsSelected}" Value="True">
                                                <Setter Property="TextColor" Value="#1a3029"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Label.Style>
                            </Label>
                        </VerticalStackLayout>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <CollectionView Grid.Row="1" 
                        ItemsSource="{Binding Sessions}"
                        Margin="0,10,0,0">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="15"/>
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Session">
                    <Border StrokeShape="RoundRectangle 15"
                            Stroke="#4d6b5e"
                            StrokeThickness="1"
                            BackgroundColor="#2d453d"
                            Padding="15"
                            Margin="15,5">

                        <Border.Shadow>
                            <Shadow Brush="Black" Offset="0,4" Radius="5" Opacity="0.3"/>
                        </Border.Shadow>

                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding Path=BindingContext.GoToDetailCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                      CommandParameter="{Binding .}" />
                        </Border.GestureRecognizers>

                        <Grid RowDefinitions="Auto, Auto, Auto, Auto" RowSpacing="8">

                            <Grid Grid.Row="0" ColumnDefinitions="*, Auto">
                                <Label Text="{Binding Title}" FontSize="18" TextColor="White" FontAttributes="Bold" LineBreakMode="TailTruncation"/>
                                <Label Grid.Column="1" Text="â€º" FontSize="26" TextColor="#facc43" TranslationY="-6" FontAttributes="Bold"/>
                            </Grid>

                            <Label Grid.Row="1" Text="{Binding Description}" FontSize="13" TextColor="#b0c4ba" MaxLines="2" LineBreakMode="TailTruncation"/>

                            <Grid Grid.Row="2" ColumnDefinitions="Auto, 20, Auto" Margin="0,5">
                                <HorizontalStackLayout Grid.Column="0" Spacing="6">
                                    <Label Text="ðŸ“…" FontSize="14"/>
                                    <Label Text="{Binding Date, StringFormat='{0:dd MMM}'}" FontSize="14" TextColor="#facc43" FontAttributes="Bold"/>
                                </HorizontalStackLayout>

                                <HorizontalStackLayout Grid.Column="2" Spacing="6">
                                    <Label Text="ðŸ•’" FontSize="14"/>
                                    <Label Text="{Binding Date, StringFormat='{0:HH:mm}'}" FontSize="14" TextColor="#facc43" FontAttributes="Bold"/>
                                </HorizontalStackLayout>
                            </Grid>

                            <HorizontalStackLayout Grid.Row="3" Spacing="6">
                                <Label Text="ðŸ‘¤" FontSize="14"/>
                                <Label FontSize="13" TextColor="#8ca096">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="{Binding FreeSpots}" FontAttributes="Bold" TextColor="White" FontSize="14"/>
                                            <Span Text=" lugares disponibles"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                            </HorizontalStackLayout>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </Grid>
</ContentPage>